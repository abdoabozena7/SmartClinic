<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #f0fbf9 0%, #f7faff 100%);
      margin: 0;
      padding: 20px;
      color: #0f172a;
    }

    h1, h2 {
      margin: 0 0 12px;
      line-height: 1.2;
    }

    h1 {
      text-align: center;
      color: #0ea5a4;
      letter-spacing: 0.4px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.8);
    }

    h2 {
      color: #0c4a6e;
    }

    section {
      background-color: #ffffff;
      padding: 18px;
      margin-bottom: 22px;
      border-radius: 14px;
      border: 1px solid #d9f2ee;
      box-shadow: 0 6px 18px rgba(14,165,164,0.10), 0 1px 0 rgba(14,165,164,0.08) inset;
      transition: box-shadow .2s ease, transform .2s ease;
    }
    section:hover {
      box-shadow: 0 10px 24px rgba(14,165,164,0.15);
      transform: translateY(-1px);
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 700;
      color: #075985;
    }

    /* تعديل العرض */
    input, select, textarea {
      display: inline-block;
      inline-size: fit-content;
      min-inline-size: 240px;
      max-inline-size: 420px;
      padding: 10px 12px;
      margin-top: 6px;
      box-sizing: border-box;
      border: 1.5px solid #c7ece7;
      border-radius: 10px;
      background: #fbfffe;
      outline: none;
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }
    input::placeholder, textarea::placeholder {
      color: #94a3b8;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #0ea5a4;
      box-shadow: 0 0 0 4px rgba(14,165,164,0.15);
      background: #ffffff;
    }

    .time-input { min-inline-size: 160px; max-inline-size: 220px; }
    #dateInput { min-inline-size: 180px; }
    #doctorSelect, #serviceSelect { min-inline-size: 260px; }
    #doctorName, #doctorServices { max-inline-size: 480px; }

    button {
      margin-top: 14px;
      padding: 10px 18px;
      background-image: linear-gradient(180deg, #14b8a6, #0ea5a4);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.2px;
      box-shadow: 0 6px 14px rgba(20,184,166,0.25);
      transition: transform .1s ease, box-shadow .2s ease, filter .2s ease, background .2s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(20,184,166,0.28);
      filter: brightness(1.02);
    }
    button:active {
      transform: translateY(0);
    }

    #simulateBtn {
      background-image: linear-gradient(180deg, #38bdf8, #0ea5e9) !important;
      box-shadow: 0 6px 14px rgba(14,165,233,0.25) !important;
    }
    #simulateBtn:hover { box-shadow: 0 10px 18px rgba(14,165,233,0.30) !important; }

    #logoutBtn {
      background-image: linear-gradient(180deg, #ef4444, #dc2626) !important;
      box-shadow: 0 6px 14px rgba(239,68,68,0.25) !important;
    }
    #logoutBtn:hover { box-shadow: 0 10px 18px rgba(239,68,68,0.30) !important; }

    .message {
      margin-top: 10px;
      color: #059669;
      font-weight: 700;
    }

    .error {
      margin-top: 10px;
      color: #b91c1c;
      font-weight: 700;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e0f2fe;
    }
    th, td {
      border-bottom: 1px solid #eaf6ff;
      padding: 12px 10px;
      text-align: center;
    }
    th {
      background: linear-gradient(180deg, #e6fffb, #ddf9ff);
      color: #0c4a6e;
      font-weight: 800;
    }
    tbody tr:nth-child(even) {
      background: #f8fffe;
    }
    tbody tr:hover {
      background: #ecfeff;
    }

    #welcome {
      color: #0f766e;
      text-align: center;
      font-weight: 600;
      background: #e6fffb;
      border: 1px solid #c7ece7;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(14,165,164,0.12) inset;
    }

    @media (max-width: 640px) {
      section { padding: 14px; }
      button { width: 100%; }
      input, select, textarea {
        inline-size: 100%;
        max-inline-size: 100%;
        min-inline-size: 0;
      }
    }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>
  <p id="welcome"></p>
  <div style="margin-bottom: 10px;">
    <button id="simulateBtn" style="margin-left: 10px;">Simulate as Patient</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <section>
    <h2>Add New Doctor</h2>
    <form id="addDoctorForm">
      <label for="doctorName">Doctor Name</label>
      <input type="text" id="doctorName" name="doctorName" required placeholder="Doctor Name">
      <label for="doctorServices">Services (comma-separated)</label>
      <input type="text" id="doctorServices" name="doctorServices" required placeholder="e.g., Extraction, Filling, Whitening">
      <button type="submit">Add</button>
      <div class="message" id="doctorSuccess" style="display:none;"></div>
      <div class="error" id="doctorError" style="display:none;"></div>
    </form>
  </section>

  <section>
    <h2>Add Timeslots for Doctor</h2>
    <form id="addTimeslotForm">
      <label for="doctorSelect">Select Doctor</label>
      <select id="doctorSelect" required>
        <option value="">-- Select Doctor --</option>
      </select>
      <label for="serviceSelect">Select Service</label>
      <select id="serviceSelect" required>
        <option value="">-- Select Service --</option>
      </select>
      <label for="dateInput">Date</label>
      <input type="date" id="dateInput" required>
      <label>Available Times</label>
      <div id="timesContainer">
        <input type="time" class="time-input" required>
      </div>
      <button type="button" id="addTimeBtn" style="margin-top:10px;background-color:#607d8b;">Add Time</button>
      <button type="submit" style="display:block;margin-top:10px;">Add Timeslots</button>
      <div class="message" id="timeslotSuccess" style="display:none;"></div>
      <div class="error" id="timeslotError" style="display:none;"></div>
    </form>
  </section>

  <section>
    <h2>All Booked Appointments</h2>
    <button id="refreshAppointments">Refresh List</button>
    <table id="appointmentsTable">
      <thead>
        <tr>
          <th>Doctor</th>
          <th>Service</th>
          <th>Date</th>
          <th>Time</th>
          <th>Patient Email</th>
        </tr>
      </thead>
      <tbody id="appointmentsBody">
      </tbody>
    </table>
  </section>
</body>
</html>
  <script>
    // Check login
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    if (!user || user.role !== 'admin') {
      window.location.href = 'login.html';
    } else {
      document.getElementById('welcome').textContent = `Welcome, ${user.email}`;
    }

    // Load doctors into select
    async function loadDoctors() {
      const res = await fetch('/api/doctors');
      const list = await res.json();
      const select = document.getElementById('doctorSelect');
      select.innerHTML = '<option value="">-- Select Doctor --</option>';
      list.forEach(doc => {
        const option = document.createElement('option');
        option.value = doc.id;
        option.textContent = doc.name;
        option.dataset.services = JSON.stringify(doc.services);
        select.appendChild(option);
      });
    }

    // Update service select when doctor changes
    document.getElementById('doctorSelect').addEventListener('change', function() {
      const selected = this.options[this.selectedIndex];
      const services = selected.dataset.services ? JSON.parse(selected.dataset.services) : [];
      const serviceSelect = document.getElementById('serviceSelect');
      serviceSelect.innerHTML = '<option value="">-- Select Service --</option>';
      services.forEach(svc => {
        const opt = document.createElement('option');
        opt.value = svc;
        opt.textContent = svc;
        serviceSelect.appendChild(opt);
      });
    });

    // Add doctor form submission
    document.getElementById('addDoctorForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('doctorName').value.trim();
      const servicesStr = document.getElementById('doctorServices').value.trim();
      const services = servicesStr.split(',').map(s => s.trim()).filter(s => s);
      const success = document.getElementById('doctorSuccess');
      const error = document.getElementById('doctorError');
      success.style.display = 'none';
      error.style.display = 'none';
      try {
        const res = await fetch('/api/doctors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, services })
        });
        const data = await res.json();
        if (res.ok) {
          success.textContent = 'Doctor added successfully.';
          success.style.display = 'block';
          this.reset();
          await loadDoctors();
        } else {
          error.textContent = data.error || 'Error adding doctor.';
          error.style.display = 'block';
        }
      } catch (err) {
        error.textContent = 'Failed to connect to the server.';
        error.style.display = 'block';
      }
    });

    // Add timeslot form submission
    document.getElementById('addTimeslotForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const doctorId = document.getElementById('doctorSelect').value;
      const service = document.getElementById('serviceSelect').value;
      const date = document.getElementById('dateInput').value;
      const timeInputs = document.querySelectorAll('#timesContainer .time-input');
      const times = Array.from(timeInputs).map(input => input.value.trim()).filter(t => t);
      const success = document.getElementById('timeslotSuccess');
      const error = document.getElementById('timeslotError');
      success.style.display = 'none';
      error.style.display = 'none';
      if (!doctorId || !service || !date || times.length === 0) {
        error.textContent = 'Please fill in all fields.';
        error.style.display = 'block';
        return;
      }
      try {
        const res = await fetch(`/api/doctors/${doctorId}/timeslots`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ date, times, service })
        });
        const data = await res.json();
        if (res.ok) {
          success.textContent = 'Timeslots added successfully.';
          success.style.display = 'block';
          this.reset();
        } else {
          error.textContent = data.error || 'Error adding timeslots.';
          error.style.display = 'block';
        }
      } catch (err) {
        error.textContent = 'Failed to connect to the server.';
        error.style.display = 'block';
      }
    });

    // Load appointments and display
    async function loadAppointments() {
      const tbody = document.getElementById('appointmentsBody');
      tbody.innerHTML = '';
      try {
        const res = await fetch('/api/appointments');
        const list = await res.json();
        list.forEach(app => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${app.doctorName}</td>
            <td>${app.service}</td>
            <td>${app.date}</td>
            <td>${app.time}</td>
            <td>${app.patientEmail}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="5">Failed to load appointments.</td>`;
        tbody.appendChild(tr);
      }
    }

    document.getElementById('refreshAppointments').addEventListener('click', loadAppointments);

    // Initial load
    loadDoctors().then(loadAppointments);

    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.removeItem('user');
      localStorage.removeItem('simulateAsPatient');
      window.location.href = 'login.html';
    });

    // Simulate as patient handler
    document.getElementById('simulateBtn').addEventListener('click', function() {
      localStorage.setItem('simulateAsPatient', 'true');
      window.location.href = 'patient.html';
    });

    // Add time input fields dynamically
    document.getElementById('addTimeBtn').addEventListener('click', function() {
      const container = document.getElementById('timesContainer');
      const input = document.createElement('input');
      input.type = 'time';
      input.className = 'time-input';
      input.required = true;
      container.appendChild(input);
    });
  </script>
</body>
</html>
